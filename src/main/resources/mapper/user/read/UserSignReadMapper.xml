<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tour.user.repository.read.UserMemberReadRepository">
    <select id="selectUserList" resultType="map">
        SELECT
            am.mb_idx
             , IFNULL(am.mb_id, '') AS mb_id
             , IFNULL(am.mb_pw, '') AS mb_pw
             , IFNULL(am.mb_email, '') AS mb_email
             , IFNULL(am.mb_ci, '') AS mb_ci
             , IFNULL(am.mb_gender, '') AS mb_gender
             , IFNULL(am.mb_birth, '') AS mb_birth
             , DATE_FORMAT(am.mb_regdate, '%Y/%m/%d %H:%i:%s') AS mb_regdate
             , CAST(am.mb_level AS SIGNED) AS mb_level
             , CAST(am.mb_status AS SIGNED) AS mb_status
             , am.mb_nickname
             , (SELECT ls.set_1_name FROM local_set_1 ls
                WHERE ls.set_1_code = am.mb_local ) AS mb_local
             , (SELECT lss.set_2_name FROM local_set_2  lss
                WHERE lss.set_2_code = am.mb_local2 ) AS mb_local2
             , am.mb_foreigner
             , IFNULL(fi.app_type , '') AS app_type
             , IFNULL(fi.app_ver , '') AS app_ver
        FROM ad_member am
                 LEFT JOIN fcm_info fi ON am.mb_idx = fi.mb_idx
        WHERE mb_status = 1
    </select>

    <select id="selectUserOne" parameterType="map" resultType="map">
        SELECT
            am.mb_idx
             , IFNULL(am.mb_id, '') AS mb_id
             , IFNULL(am.mb_pw, '') AS mb_pw
             , IFNULL(am.mb_email, '') AS mb_email
             , IFNULL(am.mb_ci, '') AS mb_ci
             , IFNULL(am.mb_gender, '') AS mb_gender
             , IFNULL(am.mb_birth, '') AS mb_birth
             , DATE_FORMAT(am.mb_regdate, '%Y/%m/%d %H:%i:%s') AS mb_regdate
             , CAST(am.mb_level AS SIGNED) AS mb_level
             , CAST(am.mb_status AS SIGNED) AS mb_status
             , am.mb_nickname
             , (SELECT ls.set_1_name FROM local_set_1 ls
                WHERE ls.set_1_code = am.mb_local ) AS mb_local
             , (SELECT lss.set_2_name FROM local_set_2  lss
                WHERE lss.set_2_code = am.mb_local2 ) AS mb_local2
             , am.mb_foreigner
             , IFNULL(fi.app_type , '') AS app_type
             , IFNULL(fi.app_ver , '') AS app_ver
        FROM ad_member am
                 LEFT JOIN fcm_info fi ON am.mb_idx = fi.mb_idx
        WHERE mb_status = 1
          AND  am.mb_idx = #{mb_idx}
    </select>

    <select id="userDupChk" parameterType="Object" resultType="Integer">
        SELECT
            COUNT(${mb_param} = ${mb_param})
        FROM ad_member
        WHERE mb_status = 1
          AND ${mb_param} = #{mb_value}
    </select>

    <select id="userDataOne" parameterType="Object" resultType="java.util.Map">
        SELECT
            ${mb_param}
        FROM ad_member
        WHERE mb_status = 1
          AND mb_idx = #{mb_idx}
    </select>

    <select id="userLogin" parameterType="String" resultType="map">
        SELECT
            am.mb_idx
             , IFNULL(am.mb_id, '') AS mb_id
             , IFNULL(am.mb_pw, '') AS mb_pw
             , IFNULL(am.mb_email, '') AS mb_email
             , IFNULL(am.mb_ci, '') AS mb_ci
             , IFNULL(am.mb_gender, '') AS mb_gender
             , IFNULL(am.mb_birth, '') AS mb_birth
             , DATE_FORMAT(am.mb_regdate, '%Y/%m/%d %H:%i:%s') AS mb_regdate
             , CAST(am.mb_level AS SIGNED) AS mb_level
             , CAST(am.mb_status AS SIGNED) AS mb_status
             , am.mb_nickname
             , (SELECT ls.set_1_name FROM local_set_1 ls
                WHERE ls.set_1_code = am.mb_local ) AS mb_local
             , (SELECT lss.set_2_name FROM local_set_2  lss
                WHERE lss.set_2_code = am.mb_local2 ) AS mb_local2
             , am.mb_foreigner
             , IFNULL(fi.app_type , '') AS app_type
             , IFNULL(fi.app_ver , '') AS app_ver
        FROM ad_member am
                 LEFT JOIN fcm_info fi ON am.mb_idx = fi.mb_idx
        WHERE mb_status = 1
          AND mb_email = #{mb_email}
    </select>

    <select id="localCategory" parameterType="String" resultType="map">
        SELECT
            ls.set_1_idx
            , ls.set_1_code
            , ls.set_1_name
            , ls.set_1_type
        FROM local_set_1 ls
        WHERE ls.set_1_type = #{mb_foreign}
    </select>

    <select id="localChoice" parameterType="String" resultType="map">
        SELECT
            lss.set_2_idx
            , lss.set_1_code
            , lss.set_2_code
            , lss.set_2_name
        FROM local_set_2 lss
        WHERE lss.set_1_code = #{mb_set_1_code}
    </select>

    <select id="sessionData" resultType="map" parameterType="map">
        SELECT
            fcm_idx
            , IFNULL(mb_idx, '') AS mb_idx
            , fcm_token
            , app_ver
            , app_type
            , device_name
            , device_os_ver
            , email_check
        FROM fcm_info
            WHERE fcm_idx = #{fcm_idx}
    </select>

</mapper>
